---
---
title: خانه
---

### مقدمه
بیایید ایده‌ای از اینکه چگونه کتابخانه به‌طور کلی به روزرسانی‌ها را مدیریت می‌کند، بدست آوریم:

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/442cc5f1-0256-425a-9f25-185fdd49fe0a" alt="نمودار فرآیند مدیریت" />
</p>

پس از دریافت یک به‌روزرسانی، کتابخانه سه مرحله اصلی را اجرا می‌کند، همانطور که می‌توانیم ببینیم.

### پردازش

پردازش بازپیچی به‌روزرسانی دریافتی به زیرکلاس مناسب [`ProcessedUpdate`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.types.component/-processed-update/index.html) بسته به بار حمل شده است.

این مرحله برای تسهیل عملیات به‌روزرسانی و توسعه توانایی‌های پردازشی لازم است.

### مدیریت

مرحله اصلی بعدی، در اینجا به خود مدیریت می‌رسیم.

### محدودکننده سرعت جهانی

اگر کاربری در به‌روزرسانی وجود داشته باشد، از ارتکاب به محدودکننده سرعت جهانی بررسی می‌کنیم.

### تجزیه متن

بسته به بار، ما یک کامپوننت به‌روزرسانی خاص حاوی متن را انتخاب کرده و براساس پیکربندی آن را تجزیه می‌کنیم.

جزئیات بیشتر را می‌توانید در [مقاله تجزیه به‌روزرسانی](Update-parsing.md) ببینید.

### یافتن فعالیت

بسته به اولویت پردازش:

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/6178c410-9b9e-4045-9f03-4791b3f49894" alt="نمودار اولویت مدیریت" />
</p>

ما در حال جستجوی تطبیق بین داده‌های تجزیه شده و فعالیت‌هایی هستیم که روی آن‌ها عمل می‌کنیم.
همانطور که در نمودار اولویت می‌بینیم، `دستورات` همیشه اول هستند.

یعنی اگر بار متنی در به‌روزرسانی با هر دستوری مطابقت داشته باشد، جستجوی بیشتر برای `ورودی‌ها`، `عمومی` و البته اجرای عمل `پردازش‌نشده` انجام نخواهد شد.

تنها چیزی این است که اگر `UpdateHandlers` وجود داشته باشد، بدون درنظر گرفتن همزمان اجرا خواهد شد.

#### دستورات

بیایید به دستورات و پردازش آن‌ها نزدیک‌تر نگاه کنیم.

همانطور که ممکن است متوجه شده باشید، اگرچه نشانه‌گذاری برای پردازش دستورات [`CommandHandler`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.annotations/-command-handler/index.html) نامیده می‌شود، اما از مفهوم کلاسیک در ربات‌های تلگرام وسیع‌تر است.

##### حوزه‌ها

این به این دلیل است که آن دارای دامنه‌ای وسیع‌تر از امکانات پردازشی است، یعنی تابع هدف می‌تواند نه تنها بسته به تطبیق متن، بلکه بسته به نوع یک به‌روزرسانی مناسب نیز تعریف شود، این مفهوم حوزه‌هاست.

به این ترتیب، هر دستور می‌تواند دستگیره‌های متفاوتی برای فهرست متفاوتی از حوزه‌ها داشته باشد، یا بالعکس، یک دستور برای چندتا.

در زیر می‌توانید ببینید که چگونه نقشه‌برداری توسط بار متنی و حوزه انجام می‌شود:

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/c870027e-750e-4bb8-a2ed-45ad93a55875" alt="نمودار حوزه دستور" />
</p>

#### ورودی‌ها

بعد، اگر بار متنی با هیچ دستوری مطابقت نداشته باشد، نقاط ورودی جستجو می‌شوند.

مفهوم بسیار شبیه به انتظار ورودی در برنامه‌های خط فرمان است، شما یک نقطه در متن بات برای یک کاربر خاص قرار می‌دهید که ورودی بعدی او را مدیریت می‌کند، مهم نیست چه چیزی دارد، مهم این است که به‌روزرسانی بعدی `User` داشته باشد تا بتوان آن را با نقطه انتظار ورودی تنظیم شده مرتبط کرد.

در زیر می‌توانید مثالی از پردازش یک به‌روزرسانی را هنگامی که هیچ مطابقتی با `دستورات` وجود ندارد، مشاهده کنید.

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/925d3e05-0985-43d5-8d6f-b3f2786ff212" alt="نمودار مثال اولویت" />
</p>

#### عمومی‌ها

اگر دستگیره هیچ `دستوری` یا `ورودی` پیدا نکند، بار متن را در مقابل دستگیره‌های `عمومی` بررسی می‌کند.

ما توصیه می‌کنیم بدون سوء استفاده از آن استفاده نکنید، زیرا آن با انجام تکرار بر روی تمام ورودی‌ها بررسی می‌کند.

#### پردازش‌نشده

و مرحله نهایی، اگر دستگیره هیچ فعالیت تطبیقی ([`UpdateHandler`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.annotations/-update-handler/index.html) کاملاً موازی کار می‌کند و به عنوان فعالیت معمولی محسوب نمی‌شود) پیدا نکند، سپس [`UnprocessedHandler`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.annotations/-unprocessed-handler/index.html) به کار می‌آید، اگر تنظیم شده باشد، این مورد را مدیریت می‌کند، ممکن است مفید باشد تا به کاربر هشدار دهید که چیزی اشتباه رفته است.

جزئیات بیشتر را در [مقاله دستگیره‌ها](Handlers.md) بخوانید.

### محدودکننده سرعت فعالیت

پس از یافتن یک فعالیت، محدودیت‌های سرعت کاربر را بر روی آن نیز براساس پارامترهای مشخص شده در پارامترهای فعالیت بررسی می‌کند.

### فعالیت

فعالیت به انواع مختلف دستگیره‌هایی اشاره دارد که کتابخانه ربات تلگرام می‌تواند مدیریت کند، شامل دستورات، ورودی‌ها، عبارات منظم و دستگیره پردازش‌نشده.

### فراخوانی

مرحله نهایی پردازش، فراخوانی فعالیت یافت شده است.

جزئیات بیشتر را می‌توانید در [مقاله فراخوانی](Activity-invocation.md) بیابید.

### همچنین ببینید

* [تجزیه به‌روزرسانی](Update-parsing.md)
* [فراخوانی فعالیت](Activity-invocation.md)
* [دستگیره‌ها](Handlers.md)
* [پیکربندی ربات](Bot-configuration.md)
* [شروع‌کننده‌های وب (Spring, Ktor)](Web-starters-(Spring-and-Ktor.md))
---