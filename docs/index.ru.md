---
---
title: Домашняя страница
---

### Введение
Давайте представим, как библиотека обрабатывает обновления в целом:

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/442cc5f1-0256-425a-9f25-185fdd49fe0a" alt="Схема процесса обработки" />
</p>

После получения обновления библиотека выполняет три основных шага, как мы видим.

### Обработка

Обработка заключается в переупаковке полученного обновления в соответствующий подкласс [`ProcessedUpdate`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.types.component/-processed-update/index.html) в зависимости от переносимой нагрузки.

Этот шаг необходим для облегчения работы с обновлением и расширения возможностей обработки.

### Обработка

Далее идет основной шаг — собственно обработка.

### Глобальный RateLimiter

Если в обновлении есть пользователь, мы проверяем превышение глобального rate limiter.

### Разбор текста

Далее, в зависимости от нагрузки, мы берем конкретный компонент обновления, содержащий текст, и разбираем его согласно конфигурации.

Более подробно можно увидеть в [статье о разборе обновлений](Update-parsing.md).

### Поиск активности

Далее, согласно приоритету обработки:

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/6178c410-9b9e-4045-9f03-4791b3f49894" alt="Схема приоритета обработки" />
</p>

Мы ищем соответствие между разобранными данными и активностями, с которыми мы работаем.
Как видно на схеме приоритета, `Команды` всегда идут первыми.

То есть, если текстовая нагрузка в обновлении соответствует какой-либо команде, дальнейший поиск `Вводов`, `Общих` и, конечно, выполнение действия `Необработанных` не будет выполняться.

Единственное — если есть `UpdateHandlers`, они будут запускаться параллельно независимо.

#### Команды

Давайте подробнее рассмотрим команды и их обработку.

Как вы могли заметить, хотя аннотация для обработки команд называется [`CommandHandler`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.annotations/-command-handler/index.html), она более универсальна, чем классическая концепция в Telegram Bots.

##### Области

Это связано с тем, что у нее более широкий спектр возможностей обработки, то есть целевая функция может быть определена не только в зависимости от совпадения текста, но и от типа подходящего обновления — это концепция областей.

Соответственно, каждая команда может иметь разные обработчики для разных списков областей, или наоборот, одна команда для нескольких.

Ниже вы можете видеть, как выполняется отображение по текстовой нагрузке и области:

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/c870027e-750e-4bb8-a2ed-45ad93a55875" alt="Схема области команды" />
</p>

#### Вводы

Далее, если текстовая нагрузка не соответствует ни одной команде, ищутся точки ввода.

Концепция очень похожа на ожидание ввода в командных строковых приложениях — вы помещаете в контекст бота для конкретного пользователя точку, которая будет обрабатывать его следующий ввод, неважно что он содержит, главное, чтобы следующее обновление имело `Пользователя`, чтобы можно было соотнести его с установленной точкой ожидания ввода.

Ниже вы можете видеть пример обработки обновления, когда нет совпадения на `Команды`.

<p align="center">
  <img src="https://github.com/vendelieu/telegram-bot/assets/3987067/925d3e05-0985-43d5-8d6f-b3f2786ff212" alt="Пример приоритета" />
</p>

#### Общие

Если обработчик не находит `команды` или `вводы`, он проверяет текстовую нагрузку на соответствие `общим` обработчикам.

Мы советуем использовать это без злоупотреблений, так как проверка выполняется итерацией по всем записям.

#### Необработанные

И финальный шаг — если обработчик не находит никакой подходящей активности ([`UpdateHandler`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.annotations/-update-handler/index.html) работает полностью параллельно и не считается обычной активностью), тогда вступает в действие [`UnprocessedHandler`](https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.annotations/-unprocessed-handler/index.html), если он установлен, он обработает этот случай, это может быть полезно для предупреждения пользователя о том, что что-то пошло не так.

Более подробно читайте в [статье Обработчики](Handlers.md).

### RateLimiter активности

После нахождения активности также проверяются лимиты пользователя на нее, согласно параметрам, указанным в параметрах активности.

### Активность

Активность относится к различным типам обработчиков, которые может обрабатывать библиотека телеграм-ботов, включая Команды, Вводы, Регулярные выражения и обработчик Необработанных.

### Вызов

Финальный шаг обработки — вызов найденной активности.

Более подробно можно найти в [статье о вызове](Activity-invocation.md).

### См. также

* [Разбор обновлений](Update-parsing.md)
* [Вызов активности](Activity-invocation.md)
* [Обработчики](Handlers.md)
* [Конфигурация бота](Bot-configuration.md)
* [Веб-стартеры (Spring, Ktor)](Web-starters-(Spring-and-Ktor.md))
---