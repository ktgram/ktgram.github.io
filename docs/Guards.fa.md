---
---
title: Guards
---

### Introduction
نگهبان‌ها یک ویژگی ضروری برای توسعه‌دهندگانی که ربات می‌سازند هستند. این نگهبان‌ها به عنوان چک‌های پیش از اجرا عمل می‌کنند که تعیین می‌کنند آیا یک دستور خاص باید فراخوانی شود یا خیر. با پیاده‌سازی این چک‌ها، توسعه‌دهندگان می‌توانند کارکرد، امنیت و تجربه کاربری ربات‌های خود را ارتقا دهند.

### هدف از نگهبان‌های فعالیت
هدف اصلی نگهبان‌های فعالیت تضمین این است که فقط کاربران مجاز یا شرایط خاصی باعث فعال شدن یک فعالیت شوند.

این می‌تواند مانع سوء استفاده شود، یکپارچگی ربات را حفظ کند و تعاملات را ساده‌تر کند.

### موارد استفاده رایج
1. تأیید هویت و مجوز: تضمین اینکه فقط کاربران خاص می‌توانند به دستورات خاصی دسترسی داشته باشند.
2. چک‌های پیش‌شرط: تأیید اینکه شرایط خاصی قبل از اجرای یک فعالیت برقرار باشد (مثلاً تضمین اینکه یک کاربر در وضعیت یا زمینه خاصی قرار دارد).
3. نگهبان‌های زمینه‌ای: تصمیم‌گیری بر اساس وضعیت گفتگوی فعلی یا کاربر.

### استراتژی‌های پیاده‌سازی
پیاده‌سازی نگهبان‌های دستور تلگرام معمولاً شامل نوشتن توابع یا متدهایی است که منطق هر نگهبان را در خود جای می‌دهند. در زیر استراتژی‌های رایج آورده شده است:

1. چک نقش کاربر:
   - تضمین اینکه کاربر نقش مورد نیاز (مثلاً مدیر، مدیر تالار) را قبل از اجرای دستور داشته باشد.
      ```kotlin
       override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        // بررسی اینکه آیا کاربر در گفتگوی داده شده مدیر است
       }
      ```

2. تأیید وضعیت:
   - بررسی وضعیت کاربر قبل از اجازه دادن به اجرای دستور.
     ```kotlin
     override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        return bot.userData[user.id, "data"] == requiredState
     }
     ```

3. نگهبان‌های سفارشی:
   - ایجاد منطق سفارشی بر اساس نیازهای خاص.
     ```kotlin
     override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        // منطق سفارشی برای تعیین اینکه آیا دستور باید اجرا شود
     }
     ```

### ادغام نگهبان‌ها با فعالیت‌ها
برای ادغام این نگهبان‌ها با دستورات ربات خود، می‌توانید یک نگهبان ایجاد کنید که این شرایط را قبل از اینکه handler دستور فراخوانی شود بررسی کند.

### پیاده‌سازی نمونه

```kotlin
// کلاس نگهبان خود را که interface Guard را پیاده‌سازی می‌کند، در جایی تعریف کنید
object YourGuard : Guard {
    override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        // شرط خود را اینجا بنویسید
    }
}

// ...

@CommandHandler(["yourCommand"])
@Guard(YourGuard::class) // InputHandler نیز پشتیبانی می‌شود
fun command(bot: TelegramBot) {
   // بدنه دستور
}
```

### بهترین شیوه‌ها

- مدولاریته: منطق نگهبان را مدولار نگه دارید و از فعالیت‌ها جدا کنید.
- قابلیت استفاده مجدد: توابع نگهبان قابل استفاده مجدد بنویسید که به راحتی می‌توان آن‌ها را در دستورات/ورودی‌های مختلف اعمال کرد.
- کارایی: چک‌های نگهبان را بهینه کنید تا بار عملکردی را کمینه کنید.
- بازخورد کاربر: بازخورد واضحی به کاربران بدهید وقتی دستوری توسط یک نگهبان مسدود می‌شود.

### نتیجه‌گیری

نگهبان‌های فعالیت یک ابزار قدرتمند برای مدیریت اجرای دستورات/ورودی ربات هستند.

با پیاده‌سازی سازوکارهای نگهبان قوی، توسعه‌دهندگان می‌توانند تضمین کنند ربات‌هایشان به صورت امن و کارآمد عمل می‌کنند و تجربه بهتری برای کاربر ارائه می‌دهند.

### همچنین ببینید

* [فعالیت‌ها و پردازش‌گرها](Activites-and-Processors.md)
* [پردازش آپدیت](Update-parsing.md)
* [اقدامات](Actions.md)
* [فراخوانی فعالیت](Activity-invocation.md)