---
---
title: Guards
---

### Введение
Guards - это важная функция для разработчиков, создающих ботов. Эти guards действуют как предварительные проверки перед выполнением, которые определяют, должен ли быть вызван определенный командный обработчик. Реализуя эти проверки, разработчики могут улучшить функциональность, безопасность и пользовательский опыт своих ботов.

### Назначение Guards активности
Основное назначение guards активности - обеспечить, чтобы только авторизованные пользователи или определенные условия запускали активность.

Это может предотвратить неправильное использование, поддерживать целостность бота и оптимизировать взаимодействия.

### Распространенные сценарии использования
1. Аутентификация и авторизация: Обеспечение доступа только определенных пользователей к конкретным командам.
2. Проверки предварительных условий: Проверка выполнения определенных условий перед выполнением активности (например, проверка нахождения пользователя в определенном состоянии или контексте).
3. Контекстные guards: Принятие решений на основе текущего состояния чата или пользователя.

### Стратегии реализации
Реализация Telegram Command Guards обычно включает написание функций или методов, которые инкапсулируют логику для каждого guard. Ниже приведены распространенные стратегии:

1. Проверка роли пользователя:
   - Обеспечение наличия у пользователя необходимой роли (например, администратор, модератор) перед выполнением команды.
      ```kotlin
       override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        // Check if the user is an admin in the given chat
       }
      ```

2. Проверка состояния:
   - Проверка состояния пользователя перед разрешением выполнения команды.
     ```kotlin
     override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        return bot.userData[user.id, "data"] == requiredState
     }
     ```

3. Пользовательские guards:
   - Создание пользовательской логики на основе конкретных требований.
     ```kotlin
     override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        // Custom logic to determine if the command should be executed
     }
     ```

### Интеграция guards с активностями
Для интеграции этих guards с вашими командными обработчиками ботов, вы можете создать guard, который проверяет эти условия перед вызовом обработчика команды.

### Пример реализации

```kotlin
// define somewhere your guard class that implements Guard interface
object YourGuard : Guard {
    override suspend fun condition(user: User?, update: ProcessedUpdate, bot: TelegramBot): Boolean {
        // write your condition here
    }
}

// ...

@CommandHandler(["yourCommand"])
@Guard(YourGuard::class) // InputHandler also is supported
fun command(bot: TelegramBot) {
   // command body
}
```

### Рекомендации

- Модульность: Сохраняйте логику guard модульной и отдельной от активностей.
- Повторное использование: Пишите повторно используемые guard функции, которые можно легко применить к различным командам/входным данным.
- Эффективность: Оптимизируйте проверки guard для минимизации накладных расходов на производительность.
- Обратная связь с пользователем: Предоставляйте четкую обратную связь пользователям, когда команда блокируется guard.

### Заключение

Activity Guards - это мощный инструмент для управления выполнением команд/входных данных бота.

Реализуя надежные механизмы guard, разработчики могут обеспечить безопасную и эффективную работу своих ботов, предоставляя лучший пользовательский опыт.

### См. также

* [Activities and Proccessors](Activites-and-Processors.md)
* [Update parsing](Update-parsing.md)
* [Actions](Actions.md)
* [Activity invocation](Activity-invocation.md)

---