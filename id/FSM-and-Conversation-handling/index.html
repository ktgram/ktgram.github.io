<!doctype html><html class=no-js lang=id><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Telegram Bot API wrapper with handy Kotlin DSL." name=description><link href=https://tgbot.vendeli.eu/id/FSM-and-Conversation-handling/ rel=canonical><link href=../F.A.Q/ rel=prev><link href=../Functional-DSL/ rel=next><link href=../../FSM-and-Conversation-handling/ hreflang=en rel=alternate><link href=../../zh/FSM-and-Conversation-handling/ hreflang=zh rel=alternate><link href=../../hi/FSM-and-Conversation-handling/ hreflang=hi rel=alternate><link href=../../ru/FSM-and-Conversation-handling/ hreflang=ru rel=alternate><link href=../../ko/FSM-and-Conversation-handling/ hreflang=ko rel=alternate><link href=../../fa/FSM-and-Conversation-handling/ hreflang=fa rel=alternate><link href=../../pt/FSM-and-Conversation-handling/ hreflang=pt rel=alternate><link href=./ hreflang=id rel=alternate><link href=../../vi/FSM-and-Conversation-handling/ hreflang=vi rel=alternate><link href=../../assets/img/lib-logo.png rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name=generator><title>Fsm Dan Penanganan Percakapan - Telegram bot</title><link href=../../assets/stylesheets/main.484c7ddc.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.ab4e12ef.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../assets/stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL(`../..`,location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+`.`+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+`.`+e,JSON.stringify(_))}catch{}};</script><body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=slate dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#secara-teori> Lewati ke isi </a></div><div data-md-component=announce></div><header class=md-header data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a aria-label="Telegram bot" class="md-header__button md-logo" title="Telegram bot" data-md-component=logo href=../> <img alt=logo src=../../assets/img/lib-logo.png> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> Telegram bot </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Fsm Dan Penanganan Percakapan </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to light mode" data-md-color-media="(prefers-color-scheme: dark)" class=md-option data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=slate id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg></label><input aria-label="Switch to dark mode" data-md-color-media="(prefers-color-scheme: light)" class=md-option data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=default id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><div class=md-header__option><div class=md-select><button aria-label="Pilih bahasa" class="md-header__button md-icon"><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg></button><div class=md-select__inner><ul class=md-select__list><li class=md-select__item><a class=md-select__link href=../../FSM-and-Conversation-handling/ hreflang=en> English </a><li class=md-select__item><a class=md-select__link href=../../zh/FSM-and-Conversation-handling/ hreflang=zh> 中文 </a><li class=md-select__item><a class=md-select__link href=../../hi/FSM-and-Conversation-handling/ hreflang=hi> हिन्दी </a><li class=md-select__item><a class=md-select__link href=../../ru/FSM-and-Conversation-handling/ hreflang=ru> Русский </a><li class=md-select__item><a class=md-select__link href=../../ko/FSM-and-Conversation-handling/ hreflang=ko> 한국어 </a><li class=md-select__item><a class=md-select__link href=../../fa/FSM-and-Conversation-handling/ hreflang=fa> فارسی </a><li class=md-select__item><a class=md-select__link href=../../pt/FSM-and-Conversation-handling/ hreflang=pt> Português </a><li class=md-select__item><a class=md-select__link href=./ hreflang=id> Bahasa Indonesia </a><li class=md-select__item><a class=md-select__link href=../../vi/FSM-and-Conversation-handling/ hreflang=vi> Tiếng Việt </a></ul></div></div></div><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Cari autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Cari required spellcheck=false type=text><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav aria-label=Cari class=md-search__options><a class="md-search__icon md-icon" aria-label=Bagikan data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Bagikan> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a><button class="md-search__icon md-icon" aria-label=Kosongkan tabindex=-1 title=Kosongkan type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Mempersiapkan pencarian</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Ke repositori" class=md-source data-md-component=source href=https://github.com/vendelieu/telegram-bot> <div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg></div> <div class=md-source__repository>vendelieu/telegram-bot</div> </a></div></nav></header><div class=md-container data-md-component=container><nav aria-label=Tab class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../> Home </a><li class="md-tabs__item md-tabs__item--active"><a class=md-tabs__link href=../Actions/> Documentation </a><li class=md-tabs__item><a class=md-tabs__link href=https://vendelieu.github.io/telegram-bot/> API Reference </a></ul></div></nav><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigasi data-md-level=0><label class=md-nav__title for=__drawer><a aria-label="Telegram bot" class="md-nav__button md-logo" title="Telegram bot" data-md-component=logo href=../> <img alt=logo src=../../assets/img/lib-logo.png> </a> Telegram bot</label><div class=md-nav__source><a title="Ke repositori" class=md-source data-md-component=source href=https://github.com/vendelieu/telegram-bot> <div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg></div> <div class=md-source__repository>vendelieu/telegram-bot</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../> <span class=md-ellipsis> Home </span> </a><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" checked id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2 id=__nav_2_label><span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span></label> <nav aria-expanded=true aria-labelledby=__nav_2_label class=md-nav data-md-level=1><label class=md-nav__title for=__nav_2><span class="md-nav__icon md-icon"></span> Documentation</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../Actions/> <span class=md-ellipsis> Actions </span> </a><li class=md-nav__item><a class=md-nav__link href=../Activites-and-Processors/> <span class=md-ellipsis> Activites And Processors </span> </a><li class=md-nav__item><a class=md-nav__link href=../Activity-invocation/> <span class=md-ellipsis> Activity Invocation </span> </a><li class=md-nav__item><a class=md-nav__link href=../Bot-Context/> <span class=md-ellipsis> Bot Context </span> </a><li class=md-nav__item><a class=md-nav__link href=../Bot-configuration/> <span class=md-ellipsis> Konfigurasi Bot </span> </a><li class=md-nav__item><a class=md-nav__link href=../F.A.Q/> <span class=md-ellipsis> F.A.Q </span> </a><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> Fsm Dan Penanganan Percakapan </span> <span class="md-nav__icon md-icon"></span></label> <a class="md-nav__link md-nav__link--active" href=./> <span class=md-ellipsis> Fsm Dan Penanganan Percakapan </span> </a> <nav aria-label="On this page" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> On this page</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#secara-teori> <span class=md-ellipsis> Secara Teori </span> </a><li class=md-nav__item><a class=md-nav__link href=#secara-praktik> <span class=md-ellipsis> Secara Praktik </span> </a><li class=md-nav__item><a class=md-nav__link href=#konsep-inti> <span class=md-ellipsis> Konsep Inti </span> </a> <nav aria-label="Konsep Inti" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#wizardstep> <span class=md-ellipsis> WizardStep </span> </a><li class=md-nav__item><a class=md-nav__link href=#transition> <span class=md-ellipsis> Transition </span> </a><li class=md-nav__item><a class=md-nav__link href=#wizardcontext> <span class=md-ellipsis> WizardContext </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#mendefinisikan-wizard> <span class=md-ellipsis> Mendefinisikan Wizard </span> </a> <nav aria-label="Mendefinisikan Wizard" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#struktur-dasar> <span class=md-ellipsis> Struktur Dasar </span> </a><li class=md-nav__item><a class=md-nav__link href=#parameter-anotasi> <span class=md-ellipsis> Parameter Anotasi </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#manajemen-status> <span class=md-ellipsis> Manajemen Status </span> </a> <nav aria-label="Manajemen Status" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#wizardstatemanager> <span class=md-ellipsis> WizardStateManager </span> </a><li class=md-nav__item><a class=md-nav__link href=#pencocokan-otomatis> <span class=md-ellipsis> Pencocokan Otomatis </span> </a><li class=md-nav__item><a class=md-nav__link href=#override-per-langkah> <span class=md-ellipsis> Override Per-Langkah </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#akses-status-type-safe> <span class=md-ellipsis> Akses Status Type-Safe </span> </a> <nav aria-label="Akses Status Type-Safe" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#fungsi-yang-dihasilkan> <span class=md-ellipsis> Fungsi yang Dihasilkan </span> </a><li class=md-nav__item><a class=md-nav__link href=#penggunaan> <span class=md-ellipsis> Penggunaan </span> </a><li class=md-nav__item><a class=md-nav__link href=#metode-fallback> <span class=md-ellipsis> Metode Fallback </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#contoh-lengkap> <span class=md-ellipsis> Contoh Lengkap </span> </a> <nav aria-label="Contoh Lengkap" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#user-registration-wizard> <span class=md-ellipsis> User Registration Wizard </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#fitur-lanjutan> <span class=md-ellipsis> Fitur Lanjutan </span> </a> <nav aria-label="Fitur Lanjutan" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#transisi-bersyarat> <span class=md-ellipsis> Transisi Bersyarat </span> </a><li class=md-nav__item><a class=md-nav__link href=#langkah-tanpa-status> <span class=md-ellipsis> Langkah Tanpa Status </span> </a><li class=md-nav__item><a class=md-nav__link href=#state-manager-kustom> <span class=md-ellipsis> State Manager Kustom </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#cara-kerja-internal> <span class=md-ellipsis> Cara Kerja Internal </span> </a> <nav aria-label="Cara Kerja Internal" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#generasi-kode> <span class=md-ellipsis> Generasi Kode </span> </a><li class=md-nav__item><a class=md-nav__link href=#alur> <span class=md-ellipsis> Alur </span> </a><li class=md-nav__item><a class=md-nav__link href=#persistensi-status> <span class=md-ellipsis> Persistensi Status </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#praktik-terbaik> <span class=md-ellipsis> Praktik Terbaik </span> </a> <nav aria-label="Praktik Terbaik" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#1-selalu-berikan-prompt-yang-jelas> <span class=md-ellipsis> 1. Selalu Berikan Prompt yang Jelas </span> </a><li class=md-nav__item><a class=md-nav__link href=#2-tangani-kesalahan-validasi-dengan-baik> <span class=md-ellipsis> 2. Tangani Kesalahan Validasi dengan Baik </span> </a><li class=md-nav__item><a class=md-nav__link href=#3-gunakan-akses-status-type-safe> <span class=md-ellipsis> 3. Gunakan Akses Status Type-Safe </span> </a><li class=md-nav__item><a class=md-nav__link href=#4-pertahankan-langkah-yang-fokus> <span class=md-ellipsis> 4. Pertahankan Langkah yang Fokus </span> </a><li class=md-nav__item><a class=md-nav__link href=#5-gunakan-nama-langkah-yang-bermakna> <span class=md-ellipsis> 5. Gunakan Nama Langkah yang Bermakna </span> </a><li class=md-nav__item><a class=md-nav__link href=#6-bersihkan-status-jika-diperlukan> <span class=md-ellipsis> 6. Bersihkan Status Jika Diperlukan </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#ringkasan> <span class=md-ellipsis> Ringkasan </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=../Functional-DSL/> <span class=md-ellipsis> Functional Dsl </span> </a><li class=md-nav__item><a class=md-nav__link href=../Guards/> <span class=md-ellipsis> Guards </span> </a><li class=md-nav__item><a class=md-nav__link href=../Handlers/> <span class=md-ellipsis> Handlers </span> </a><li class=md-nav__item><a class=md-nav__link href=../Interceptors-%28middleware%29/> <span class=md-ellipsis> Interceptors (Middleware) </span> </a><li class=md-nav__item><a class=md-nav__link href=../Update-parsing/> <span class=md-ellipsis> Update Parsing </span> </a><li class=md-nav__item><a class=md-nav__link href=../Useful-utilities-and-tips/> <span class=md-ellipsis> Utilities dan Tips Berguna </span> </a><li class=md-nav__item><a class=md-nav__link href=../Web-starters-%28Spring-and-Ktor%29/> <span class=md-ellipsis> Web Starters (Spring Dan Ktor) </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=https://vendelieu.github.io/telegram-bot/> <span class=md-ellipsis> API Reference </span> </a></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> On this page</label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#secara-teori> <span class=md-ellipsis> Secara Teori </span> </a><li class=md-nav__item><a class=md-nav__link href=#secara-praktik> <span class=md-ellipsis> Secara Praktik </span> </a><li class=md-nav__item><a class=md-nav__link href=#konsep-inti> <span class=md-ellipsis> Konsep Inti </span> </a> <nav aria-label="Konsep Inti" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#wizardstep> <span class=md-ellipsis> WizardStep </span> </a><li class=md-nav__item><a class=md-nav__link href=#transition> <span class=md-ellipsis> Transition </span> </a><li class=md-nav__item><a class=md-nav__link href=#wizardcontext> <span class=md-ellipsis> WizardContext </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#mendefinisikan-wizard> <span class=md-ellipsis> Mendefinisikan Wizard </span> </a> <nav aria-label="Mendefinisikan Wizard" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#struktur-dasar> <span class=md-ellipsis> Struktur Dasar </span> </a><li class=md-nav__item><a class=md-nav__link href=#parameter-anotasi> <span class=md-ellipsis> Parameter Anotasi </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#manajemen-status> <span class=md-ellipsis> Manajemen Status </span> </a> <nav aria-label="Manajemen Status" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#wizardstatemanager> <span class=md-ellipsis> WizardStateManager </span> </a><li class=md-nav__item><a class=md-nav__link href=#pencocokan-otomatis> <span class=md-ellipsis> Pencocokan Otomatis </span> </a><li class=md-nav__item><a class=md-nav__link href=#override-per-langkah> <span class=md-ellipsis> Override Per-Langkah </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#akses-status-type-safe> <span class=md-ellipsis> Akses Status Type-Safe </span> </a> <nav aria-label="Akses Status Type-Safe" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#fungsi-yang-dihasilkan> <span class=md-ellipsis> Fungsi yang Dihasilkan </span> </a><li class=md-nav__item><a class=md-nav__link href=#penggunaan> <span class=md-ellipsis> Penggunaan </span> </a><li class=md-nav__item><a class=md-nav__link href=#metode-fallback> <span class=md-ellipsis> Metode Fallback </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#contoh-lengkap> <span class=md-ellipsis> Contoh Lengkap </span> </a> <nav aria-label="Contoh Lengkap" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#user-registration-wizard> <span class=md-ellipsis> User Registration Wizard </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#fitur-lanjutan> <span class=md-ellipsis> Fitur Lanjutan </span> </a> <nav aria-label="Fitur Lanjutan" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#transisi-bersyarat> <span class=md-ellipsis> Transisi Bersyarat </span> </a><li class=md-nav__item><a class=md-nav__link href=#langkah-tanpa-status> <span class=md-ellipsis> Langkah Tanpa Status </span> </a><li class=md-nav__item><a class=md-nav__link href=#state-manager-kustom> <span class=md-ellipsis> State Manager Kustom </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#cara-kerja-internal> <span class=md-ellipsis> Cara Kerja Internal </span> </a> <nav aria-label="Cara Kerja Internal" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#generasi-kode> <span class=md-ellipsis> Generasi Kode </span> </a><li class=md-nav__item><a class=md-nav__link href=#alur> <span class=md-ellipsis> Alur </span> </a><li class=md-nav__item><a class=md-nav__link href=#persistensi-status> <span class=md-ellipsis> Persistensi Status </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#praktik-terbaik> <span class=md-ellipsis> Praktik Terbaik </span> </a> <nav aria-label="Praktik Terbaik" class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#1-selalu-berikan-prompt-yang-jelas> <span class=md-ellipsis> 1. Selalu Berikan Prompt yang Jelas </span> </a><li class=md-nav__item><a class=md-nav__link href=#2-tangani-kesalahan-validasi-dengan-baik> <span class=md-ellipsis> 2. Tangani Kesalahan Validasi dengan Baik </span> </a><li class=md-nav__item><a class=md-nav__link href=#3-gunakan-akses-status-type-safe> <span class=md-ellipsis> 3. Gunakan Akses Status Type-Safe </span> </a><li class=md-nav__item><a class=md-nav__link href=#4-pertahankan-langkah-yang-fokus> <span class=md-ellipsis> 4. Pertahankan Langkah yang Fokus </span> </a><li class=md-nav__item><a class=md-nav__link href=#5-gunakan-nama-langkah-yang-bermakna> <span class=md-ellipsis> 5. Gunakan Nama Langkah yang Bermakna </span> </a><li class=md-nav__item><a class=md-nav__link href=#6-bersihkan-status-jika-diperlukan> <span class=md-ellipsis> 6. Bersihkan Status Jika Diperlukan </span> </a></ul></nav><li class=md-nav__item><a class=md-nav__link href=#ringkasan> <span class=md-ellipsis> Ringkasan </span> </a></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1>Fsm Dan Penanganan Percakapan</h1><p>Perpustakaan ini juga mendukung mekanisme FSM, yang merupakan mekanisme untuk pemrosesan progresif input pengguna dengan penanganan input yang salah.<div class="admonition note"><p class=admonition-title>Note<p>TL;DR: Lihat contoh <a href=https://github.com/vendelieu/telegram-bot_template/tree/conversation>di sana</a>.</div><h3 id=secara-teori>Secara Teori<a title="Permanent link" class=headerlink href=#secara-teori>¶</a></h3><p>Mari kita bayangkan situasi di mana Anda perlu mengumpulkan survei pengguna, Anda dapat meminta semua data seseorang dalam satu langkah, tetapi dengan input yang salah dari salah satu parameter, akan sulit baik untuk pengguna maupun untuk kita, dan setiap langkah mungkin berbeda tergantung pada data input tertentu.<p>Sekarang mari kita bayangkan input data secara bertahap, di mana bot memasuki mode dialog dengan pengguna.<p align=center><img alt="Diagram Proses Penanganan" src=https://github.com/vendelieu/telegram-bot/assets/3987067/2e84fa00-e59c-4352-8665-83be3b971e7b><p>Panah hijau menunjukkan proses transisi melalui langkah-langkah tanpa kesalahan, panah biru berarti menyimpan status saat ini dan menunggu input ulang (misalnya, jika pengguna menunjukkan bahwa dia berusia -100 tahun, itu harus meminta usia lagi), dan yang merah menunjukkan keluar dari seluruh proses karena ada perintah atau pembatalan makna lainnya.<h3 id=secara-praktik>Secara Praktik<a title="Permanent link" class=headerlink href=#secara-praktik>¶</a></h3><p>Sistem Wizard memungkinkan interaksi multi-langkah dengan pengguna di bot Telegram. Ini membimbing pengguna melalui urutan langkah-langkah, memvalidasi input, menyimpan status, dan beralih antar langkah.<p><strong>Manfaat Utama:</strong> - <strong>Type-safe</strong>: Pemeriksaan tipe waktu kompilasi untuk akses status - <strong>Declarative</strong>: Tentukan langkah-langkah sebagai kelas/objek bersarang - <strong>Flexible</strong>: Dukungan untuk transisi bersyarat, lompatan, dan retry - <strong>Stateful</strong>: Persistensi status otomatis dengan backend penyimpanan yang dapat dihubungkan - <strong>Integrated</strong>: Bekerja dengan sistem Activity yang ada<h3 id=konsep-inti>Konsep Inti<a title="Permanent link" class=headerlink href=#konsep-inti>¶</a></h3><h4 id=wizardstep>WizardStep<a title="Permanent link" class=headerlink href=#wizardstep>¶</a></h4><p><code>WizardStep</code> mewakili satu langkah dalam alur wizard. Setiap langkah harus mengimplementasikan:<ul><li><strong><code>onEntry(ctx: WizardContext)</code></strong>: Dipanggil ketika pengguna memasuki langkah ini. Gunakan ini untuk meminta pengguna.<li><strong><code>onRetry(ctx: WizardContext)</code></strong>: Dipanggil ketika validasi gagal dan langkah harus retry. Gunakan ini untuk menampilkan pesan kesalahan.<li><strong><code>validate(ctx: WizardContext): Transition</code></strong>: Memvalidasi input saat ini dan mengembalikan <code>Transition</code> yang menunjukkan apa yang terjadi selanjutnya.<li><strong><code>store(ctx: WizardContext): Any?</code></strong> (opsional): Mengembalikan nilai yang akan disimpan untuk langkah ini. Kembalikan <code>null</code> jika langkah tidak menyimpan status.</ul><div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=kd>object</span><span class=w> </span><span class=nc>NameStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=p>(</span><span class=n>isInitial</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>        </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"What is your name?"</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a>
<a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>        </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"Name cannot be empty. Please try again."</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a>
<a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=p>.</span><span class=na>isNullOrBlank</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>            </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>            </span><span class=n>Transition</span><span class=p>.</span><span class=na>Next</span>
<a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-0-16 id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-0-17 id=__codelineno-0-17 name=__codelineno-0-17></a>
<a href=#__codelineno-0-18 id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>store</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=kt>String</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-19 id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>!!</span>
<a href=#__codelineno-0-20 id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-0-21 id=__codelineno-0-21 name=__codelineno-0-21></a><span class=p>}</span>
</code></pre></div><div class="admonition note"><p class=admonition-title>Note<p>Jika beberapa langkah tidak ditandai sebagai initial -> langkah pertama yang dideklarasikan dianggap sebagai.</div><h4 id=transition>Transition<a title="Permanent link" class=headerlink href=#transition>¶</a></h4><p><code>Transition</code> menentukan apa yang terjadi setelah validasi:<ul><li><strong><code>Transition.Next</code></strong>: Pindah ke langkah berikutnya dalam urutan<li><strong><code>Transition.JumpTo(step: KClass&lt;out WizardStep>)</code></strong>: Lompat ke langkah tertentu<li><strong><code>Transition.Retry</code></strong>: Retry langkah saat ini (validasi gagal)<li><strong><code>Transition.Finish</code></strong>: Selesaikan wizard</ul><div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=c1>// Lompatan bersyarat berdasarkan input</span>
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>?.</span><span class=na>toIntOrNull</span><span class=p>()</span>
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>        </span><span class=n>age</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>        </span><span class=n>age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=m>18</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>JumpTo</span><span class=p>(</span><span class=n>UnderageStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
<a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Next</span>
<a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=p>}</span>
</code></pre></div><h4 id=wizardcontext>WizardContext<a title="Permanent link" class=headerlink href=#wizardcontext>¶</a></h4><p><code>WizardContext</code> menyediakan akses ke: - <strong><code>user: User</code></strong>: Pengguna saat ini - <strong><code>update: ProcessedUpdate</code></strong>: Update saat ini - <strong><code>bot: TelegramBot</code></strong>: Instance bot - <strong><code>userReference: UserChatReference</code></strong>: Referensi ID pengguna dan chat untuk penyimpanan status<p>Plus metode akses status type-safe (dihasilkan oleh KSP).<hr><h3 id=mendefinisikan-wizard>Mendefinisikan Wizard<a title="Permanent link" class=headerlink href=#mendefinisikan-wizard>¶</a></h3><h4 id=struktur-dasar>Struktur Dasar<a title="Permanent link" class=headerlink href=#struktur-dasar>¶</a></h4><p>Wizard didefinisikan sebagai kelas atau objek yang dianotasi dengan <code>@WizardHandler</code>:<div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=nd>@WizardHandler</span><span class=p>(</span><span class=n>trigger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=s>"/survey"</span><span class=o>]</span><span class=p>)</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=kd>object</span><span class=w> </span><span class=nc>SurveyWizard</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>NameStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=p>(</span><span class=n>isInitial</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>        </span><span class=c1>// ... implementasi langkah</span>
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>AgeStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>        </span><span class=c1>// ... implementasi langkah</span>
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a>
<a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>FinishStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a><span class=w>        </span><span class=c1>// ... implementasi langkah</span>
<a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-2-14 id=__codelineno-2-14 name=__codelineno-2-14></a><span class=p>}</span>
</code></pre></div><h4 id=parameter-anotasi>Parameter Anotasi<a title="Permanent link" class=headerlink href=#parameter-anotasi>¶</a></h4><p><strong><code>@WizardHandler</code></strong> menerima: - <strong><code>trigger: Array&lt;String></code></strong>: Perintah yang memulai wizard (misalnya, <code>["/start", "/survey"]</code>) - <strong><code>scope: Array&lt;UpdateType></code></strong>: Tipe update yang akan didengarkan (default: <code>[UpdateType.MESSAGE]</code>) - <strong><code>stateManagers: Array&lt;KClass&lt;out WizardStateManager&lt;*>>></code></strong>: Kelas state manager untuk menyimpan data langkah<hr><h3 id=manajemen-status>Manajemen Status<a title="Permanent link" class=headerlink href=#manajemen-status>¶</a></h3><h4 id=wizardstatemanager>WizardStateManager<a title="Permanent link" class=headerlink href=#wizardstatemanager>¶</a></h4><p>Status disimpan menggunakan implementasi <code>WizardStateManager&lt;T></code>. Setiap manager menangani tipe tertentu:<div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=kd>interface</span><span class=w> </span><span class=nc>WizardStateManager</span><span class=o>&lt;</span><span class=n>T</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kt>Any</span><span class=o>></span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=w>    </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=n>key</span><span class=p>:</span><span class=w> </span><span class=n>KClass</span><span class=o>&lt;</span><span class=k>out</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=p>,</span><span class=w> </span><span class=n>reference</span><span class=p>:</span><span class=w> </span><span class=n>UserChatReference</span><span class=p>):</span><span class=w> </span><span class=n>T?</span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>    </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>set</span><span class=p>(</span><span class=n>key</span><span class=p>:</span><span class=w> </span><span class=n>KClass</span><span class=o>&lt;</span><span class=k>out</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=p>,</span><span class=w> </span><span class=n>reference</span><span class=p>:</span><span class=w> </span><span class=n>UserChatReference</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=n>T</span><span class=p>)</span>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>    </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>del</span><span class=p>(</span><span class=n>key</span><span class=p>:</span><span class=w> </span><span class=n>KClass</span><span class=o>&lt;</span><span class=k>out</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=p>,</span><span class=w> </span><span class=n>reference</span><span class=p>:</span><span class=w> </span><span class=n>UserChatReference</span><span class=p>)</span>
<a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=p>}</span>
</code></pre></div><p>Lihat juga: <a href=https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.implementations/-map-state-manager/index.html>MapStateManager<t>, <a href=https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.implementations/-map-string-state-manager/index.html>MapStringStateManager</a>, <a href=https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.implementations/-map-int-state-manager/index.html>MapIntStateManager</a>, <a href=https://vendelieu.github.io/telegram-bot/telegram-bot/eu.vendeli.tgbot.implementations/-map-long-state-manager/index.html>MapLongStateManager</a>. <h4 id=pencocokan-otomatis>Pencocokan Otomatis<a title="Permanent link" class=headerlink href=#pencocokan-otomatis>¶</a></h4> <p>KSP mencocokkan langkah ke state manager berdasarkan tipe kembalian <code>store()</code>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nd>@WizardHandler</span><span class=p>(</span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=w>    </span><span class=n>trigger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=s>"/survey"</span><span class=o>]</span><span class=p>,</span>
<a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=w>    </span><span class=n>stateManagers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=n>StringStateManager</span><span class=o>::</span><span class=n>class</span><span class=p>,</span><span class=w> </span><span class=n>IntStateManager</span><span class=o>::</span><span class=n>class</span><span class=o>]</span>
<a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a><span class=p>)</span>
<a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=kd>object</span><span class=w> </span><span class=nc>SurveyWizard</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>NameStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=p>(</span><span class=n>isInitial</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>store</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=kt>String</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>!!</span><span class=w> </span><span class=c1>// Cocok dengan StringStateManager</span>
<a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a>
<a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>AgeStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>store</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=kt>Int</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>!!</span><span class=p>.</span><span class=na>toInt</span><span class=p>()</span><span class=w> </span><span class=c1>// Cocok dengan IntStateManager</span>
<a href=#__codelineno-4-15 id=__codelineno-4-15 name=__codelineno-4-15></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-4-16 id=__codelineno-4-16 name=__codelineno-4-16></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-4-17 id=__codelineno-4-17 name=__codelineno-4-17></a><span class=p>}</span>
</code></pre></div> <h4 id=override-per-langkah>Override Per-Langkah<a title="Permanent link" class=headerlink href=#override-per-langkah>¶</a></h4> <p>Override state manager untuk langkah tertentu menggunakan <code>@WizardHandler.StateManager</code>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=nd>@WizardHandler</span><span class=p>(</span>
<a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=w>    </span><span class=n>trigger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=s>"/survey"</span><span class=o>]</span><span class=p>,</span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>    </span><span class=n>stateManagers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=n>DefaultStateManager</span><span class=o>::</span><span class=n>class</span><span class=o>]</span>
<a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a><span class=p>)</span>
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a><span class=kd>object</span><span class=w> </span><span class=nc>SurveyWizard</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>NameStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=p>(</span><span class=n>isInitial</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-5-7 id=__codelineno-5-7 name=__codelineno-5-7></a><span class=w>        </span><span class=c1>// Menggunakan DefaultStateManager</span>
<a href=#__codelineno-5-8 id=__codelineno-5-8 name=__codelineno-5-8></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-5-9 id=__codelineno-5-9 name=__codelineno-5-9></a>
<a href=#__codelineno-5-10 id=__codelineno-5-10 name=__codelineno-5-10></a><span class=w>    </span><span class=nd>@WizardHandler.StateManager</span><span class=p>(</span><span class=n>CustomStateManager</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
<a href=#__codelineno-5-11 id=__codelineno-5-11 name=__codelineno-5-11></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>AgeStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-5-12 id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>        </span><span class=c1>// Menggunakan CustomStateManager sebagai gantinya</span>
<a href=#__codelineno-5-13 id=__codelineno-5-13 name=__codelineno-5-13></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-5-14 id=__codelineno-5-14 name=__codelineno-5-14></a><span class=p>}</span>
</code></pre></div> <hr> <h3 id=akses-status-type-safe>Akses Status Type-Safe<a title="Permanent link" class=headerlink href=#akses-status-type-safe>¶</a></h3> <p>KSP menghasilkan fungsi ekstensi type-safe pada <code>WizardContext</code> untuk setiap langkah yang menyimpan status.</p> <h4 id=fungsi-yang-dihasilkan>Fungsi yang Dihasilkan<a title="Permanent link" class=headerlink href=#fungsi-yang-dihasilkan>¶</a></h4> <p>Untuk langkah yang menyimpan <code>String</code>:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=c1>// Dihasilkan secara otomatis oleh KSP</span>
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a><span class=kd>suspend</span><span class=w> </span><span class=kd>inline</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=o>&lt;</span><span class=k>reified</span><span class=w> </span><span class=n>S</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=w> </span><span class=n>WizardContext</span><span class=p>.</span><span class=nf>getState</span><span class=p>():</span><span class=w> </span><span class=kt>String?</span>
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=kd>suspend</span><span class=w> </span><span class=kd>inline</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=o>&lt;</span><span class=k>reified</span><span class=w> </span><span class=n>S</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=w> </span><span class=n>WizardContext</span><span class=p>.</span><span class=nf>setState</span><span class=p>(</span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>)</span>
<a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a><span class=kd>suspend</span><span class=w> </span><span class=kd>inline</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=o>&lt;</span><span class=k>reified</span><span class=w> </span><span class=n>S</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=w> </span><span class=n>WizardContext</span><span class=p>.</span><span class=nf>delState</span><span class=p>()</span>
</code></pre></div> <h4 id=penggunaan>Penggunaan<a title="Permanent link" class=headerlink href=#penggunaan>¶</a></h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=kd>object</span><span class=w> </span><span class=nc>FinishStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a><span class=w>        </span><span class=c1>// Akses type-safe - mengembalikan String? (nullable)</span>
<a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=kt>String?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>NameStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>
<a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a><span class=w>        </span><span class=c1>// Akses type-safe - mengembalikan Int? (nullable)</span>
<a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>age</span><span class=p>:</span><span class=w> </span><span class=kt>Int?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>AgeStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-7-8 id=__codelineno-7-8 name=__codelineno-7-8></a>
<a href=#__codelineno-7-9 id=__codelineno-7-9 name=__codelineno-7-9></a><span class=w>        </span><span class=kd>val</span><span class=w> </span><span class=nv>summary</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buildString</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-7-10 id=__codelineno-7-10 name=__codelineno-7-10></a><span class=w>            </span><span class=n>appendLine</span><span class=p>(</span><span class=s>"Name: </span><span class=si>$</span><span class=n>name</span><span class=s>"</span><span class=p>)</span>
<a href=#__codelineno-7-11 id=__codelineno-7-11 name=__codelineno-7-11></a><span class=w>            </span><span class=n>appendLine</span><span class=p>(</span><span class=s>"Age: </span><span class=si>$</span><span class=n>age</span><span class=s>"</span><span class=p>)</span>
<a href=#__codelineno-7-12 id=__codelineno-7-12 name=__codelineno-7-12></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-7-13 id=__codelineno-7-13 name=__codelineno-7-13></a>
<a href=#__codelineno-7-14 id=__codelineno-7-14 name=__codelineno-7-14></a><span class=w>        </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>summary</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-7-15 id=__codelineno-7-15 name=__codelineno-7-15></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-7-16 id=__codelineno-7-16 name=__codelineno-7-16></a>
<a href=#__codelineno-7-17 id=__codelineno-7-17 name=__codelineno-7-17></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>Unit</span>
<a href=#__codelineno-7-18 id=__codelineno-7-18 name=__codelineno-7-18></a>
<a href=#__codelineno-7-19 id=__codelineno-7-19 name=__codelineno-7-19></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-7-20 id=__codelineno-7-20 name=__codelineno-7-20></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Finish</span>
<a href=#__codelineno-7-21 id=__codelineno-7-21 name=__codelineno-7-21></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-7-22 id=__codelineno-7-22 name=__codelineno-7-22></a><span class=p>}</span>
</code></pre></div> <h4 id=metode-fallback>Metode Fallback<a title="Permanent link" class=headerlink href=#metode-fallback>¶</a></h4> <p>Jika metode type-safe tidak tersedia, gunakan metode fallback:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a><span class=c1>// Fallback - mengembalikan Any?</span>
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=p>(</span><span class=n>NameStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>
<a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a><span class=c1>// Fallback - menerima Any?</span>
<a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a><span class=n>ctx</span><span class=p>.</span><span class=na>setState</span><span class=p>(</span><span class=n>NameStep</span><span class=o>::</span><span class=n>class</span><span class=p>,</span><span class=w> </span><span class=s>"John"</span><span class=p>)</span>
<a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a><span class=n>ctx</span><span class=p>.</span><span class=na>delState</span><span class=p>(</span><span class=n>NameStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
</code></pre></div> <hr> <h3 id=contoh-lengkap>Contoh Lengkap<a title="Permanent link" class=headerlink href=#contoh-lengkap>¶</a></h3> <h4 id=user-registration-wizard>User Registration Wizard<a title="Permanent link" class=headerlink href=#user-registration-wizard>¶</a></h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=nd>@WizardHandler</span><span class=p>(</span>
<a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a><span class=w>    </span><span class=n>trigger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=s>"/register"</span><span class=o>]</span><span class=p>,</span>
<a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a><span class=w>    </span><span class=n>stateManagers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=n>StringStateManager</span><span class=o>::</span><span class=n>class</span><span class=p>,</span><span class=w> </span><span class=n>IntStateManager</span><span class=o>::</span><span class=n>class</span><span class=o>]</span>
<a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a><span class=p>)</span>
<a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a><span class=kd>object</span><span class=w> </span><span class=nc>RegistrationWizard</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-6 id=__codelineno-9-6 name=__codelineno-9-6></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>NameStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=p>(</span><span class=n>isInitial</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-7 id=__codelineno-9-7 name=__codelineno-9-7></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-8 id=__codelineno-9-8 name=__codelineno-9-8></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"What is your name?"</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-9 id=__codelineno-9-9 name=__codelineno-9-9></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-10 id=__codelineno-9-10 name=__codelineno-9-10></a>
<a href=#__codelineno-9-11 id=__codelineno-9-11 name=__codelineno-9-11></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-12 id=__codelineno-9-12 name=__codelineno-9-12></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"Please enter a valid name."</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-13 id=__codelineno-9-13 name=__codelineno-9-13></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-14 id=__codelineno-9-14 name=__codelineno-9-14></a>
<a href=#__codelineno-9-15 id=__codelineno-9-15 name=__codelineno-9-15></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-16 id=__codelineno-9-16 name=__codelineno-9-16></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>?.</span><span class=na>trim</span><span class=p>()</span>
<a href=#__codelineno-9-17 id=__codelineno-9-17 name=__codelineno-9-17></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=p>.</span><span class=na>isNullOrBlank</span><span class=p>()</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=m>2</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-18 id=__codelineno-9-18 name=__codelineno-9-18></a><span class=w>                </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-9-19 id=__codelineno-9-19 name=__codelineno-9-19></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-20 id=__codelineno-9-20 name=__codelineno-9-20></a><span class=w>                </span><span class=n>Transition</span><span class=p>.</span><span class=na>Next</span>
<a href=#__codelineno-9-21 id=__codelineno-9-21 name=__codelineno-9-21></a><span class=w>            </span><span class=p>}</span>
<a href=#__codelineno-9-22 id=__codelineno-9-22 name=__codelineno-9-22></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-23 id=__codelineno-9-23 name=__codelineno-9-23></a>
<a href=#__codelineno-9-24 id=__codelineno-9-24 name=__codelineno-9-24></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>store</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=kt>String</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-25 id=__codelineno-9-25 name=__codelineno-9-25></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>!!</span><span class=p>.</span><span class=na>trim</span><span class=p>()</span>
<a href=#__codelineno-9-26 id=__codelineno-9-26 name=__codelineno-9-26></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-27 id=__codelineno-9-27 name=__codelineno-9-27></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-9-28 id=__codelineno-9-28 name=__codelineno-9-28></a>
<a href=#__codelineno-9-29 id=__codelineno-9-29 name=__codelineno-9-29></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>AgeStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-30 id=__codelineno-9-30 name=__codelineno-9-30></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-31 id=__codelineno-9-31 name=__codelineno-9-31></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"How old are you?"</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-32 id=__codelineno-9-32 name=__codelineno-9-32></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-33 id=__codelineno-9-33 name=__codelineno-9-33></a>
<a href=#__codelineno-9-34 id=__codelineno-9-34 name=__codelineno-9-34></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-35 id=__codelineno-9-35 name=__codelineno-9-35></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"Please enter a valid age (must be a number)."</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-36 id=__codelineno-9-36 name=__codelineno-9-36></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-37 id=__codelineno-9-37 name=__codelineno-9-37></a>
<a href=#__codelineno-9-38 id=__codelineno-9-38 name=__codelineno-9-38></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-39 id=__codelineno-9-39 name=__codelineno-9-39></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>?.</span><span class=na>toIntOrNull</span><span class=p>()</span>
<a href=#__codelineno-9-40 id=__codelineno-9-40 name=__codelineno-9-40></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-41 id=__codelineno-9-41 name=__codelineno-9-41></a><span class=w>                </span><span class=n>age</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-9-42 id=__codelineno-9-42 name=__codelineno-9-42></a><span class=w>                </span><span class=n>age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=m>150</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-9-43 id=__codelineno-9-43 name=__codelineno-9-43></a><span class=w>                </span><span class=n>age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=m>18</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>JumpTo</span><span class=p>(</span><span class=n>UnderageStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
<a href=#__codelineno-9-44 id=__codelineno-9-44 name=__codelineno-9-44></a><span class=w>                </span><span class=k>else</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Next</span>
<a href=#__codelineno-9-45 id=__codelineno-9-45 name=__codelineno-9-45></a><span class=w>            </span><span class=p>}</span>
<a href=#__codelineno-9-46 id=__codelineno-9-46 name=__codelineno-9-46></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-47 id=__codelineno-9-47 name=__codelineno-9-47></a>
<a href=#__codelineno-9-48 id=__codelineno-9-48 name=__codelineno-9-48></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>store</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=kt>Int</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-49 id=__codelineno-9-49 name=__codelineno-9-49></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>!!</span><span class=p>.</span><span class=na>toInt</span><span class=p>()</span>
<a href=#__codelineno-9-50 id=__codelineno-9-50 name=__codelineno-9-50></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-51 id=__codelineno-9-51 name=__codelineno-9-51></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-9-52 id=__codelineno-9-52 name=__codelineno-9-52></a>
<a href=#__codelineno-9-53 id=__codelineno-9-53 name=__codelineno-9-53></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>UnderageStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-54 id=__codelineno-9-54 name=__codelineno-9-54></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-55 id=__codelineno-9-55 name=__codelineno-9-55></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span>
<a href=#__codelineno-9-56 id=__codelineno-9-56 name=__codelineno-9-56></a><span class=w>                </span><span class=s>"Sorry, you must be 18 or older to register."</span><span class=w> </span>
<a href=#__codelineno-9-57 id=__codelineno-9-57 name=__codelineno-9-57></a><span class=w>            </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-58 id=__codelineno-9-58 name=__codelineno-9-58></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-59 id=__codelineno-9-59 name=__codelineno-9-59></a>
<a href=#__codelineno-9-60 id=__codelineno-9-60 name=__codelineno-9-60></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>Unit</span>
<a href=#__codelineno-9-61 id=__codelineno-9-61 name=__codelineno-9-61></a>
<a href=#__codelineno-9-62 id=__codelineno-9-62 name=__codelineno-9-62></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-63 id=__codelineno-9-63 name=__codelineno-9-63></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Finish</span>
<a href=#__codelineno-9-64 id=__codelineno-9-64 name=__codelineno-9-64></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-65 id=__codelineno-9-65 name=__codelineno-9-65></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-9-66 id=__codelineno-9-66 name=__codelineno-9-66></a>
<a href=#__codelineno-9-67 id=__codelineno-9-67 name=__codelineno-9-67></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>ConfirmationStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-68 id=__codelineno-9-68 name=__codelineno-9-68></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-69 id=__codelineno-9-69 name=__codelineno-9-69></a><span class=w>            </span><span class=c1>// Akses status type-safe</span>
<a href=#__codelineno-9-70 id=__codelineno-9-70 name=__codelineno-9-70></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=kt>String?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>NameStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-9-71 id=__codelineno-9-71 name=__codelineno-9-71></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>age</span><span class=p>:</span><span class=w> </span><span class=kt>Int?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>AgeStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-9-72 id=__codelineno-9-72 name=__codelineno-9-72></a>
<a href=#__codelineno-9-73 id=__codelineno-9-73 name=__codelineno-9-73></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>confirmation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buildString</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-74 id=__codelineno-9-74 name=__codelineno-9-74></a><span class=w>                </span><span class=n>appendLine</span><span class=p>(</span><span class=s>"Please confirm your information:"</span><span class=p>)</span>
<a href=#__codelineno-9-75 id=__codelineno-9-75 name=__codelineno-9-75></a><span class=w>                </span><span class=n>appendLine</span><span class=p>(</span><span class=s>"Name: </span><span class=si>$</span><span class=n>name</span><span class=s>"</span><span class=p>)</span>
<a href=#__codelineno-9-76 id=__codelineno-9-76 name=__codelineno-9-76></a><span class=w>                </span><span class=n>appendLine</span><span class=p>(</span><span class=s>"Age: </span><span class=si>$</span><span class=n>age</span><span class=s>"</span><span class=p>)</span>
<a href=#__codelineno-9-77 id=__codelineno-9-77 name=__codelineno-9-77></a><span class=w>                </span><span class=n>appendLine</span><span class=p>()</span>
<a href=#__codelineno-9-78 id=__codelineno-9-78 name=__codelineno-9-78></a><span class=w>                </span><span class=n>appendLine</span><span class=p>(</span><span class=s>"Reply 'yes' to confirm or 'no' to start over."</span><span class=p>)</span>
<a href=#__codelineno-9-79 id=__codelineno-9-79 name=__codelineno-9-79></a><span class=w>            </span><span class=p>}</span>
<a href=#__codelineno-9-80 id=__codelineno-9-80 name=__codelineno-9-80></a>
<a href=#__codelineno-9-81 id=__codelineno-9-81 name=__codelineno-9-81></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>confirmation</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-82 id=__codelineno-9-82 name=__codelineno-9-82></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-83 id=__codelineno-9-83 name=__codelineno-9-83></a>
<a href=#__codelineno-9-84 id=__codelineno-9-84 name=__codelineno-9-84></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-85 id=__codelineno-9-85 name=__codelineno-9-85></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"Please reply 'yes' or 'no'."</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-86 id=__codelineno-9-86 name=__codelineno-9-86></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-87 id=__codelineno-9-87 name=__codelineno-9-87></a>
<a href=#__codelineno-9-88 id=__codelineno-9-88 name=__codelineno-9-88></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-89 id=__codelineno-9-89 name=__codelineno-9-89></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>?.</span><span class=na>lowercase</span><span class=p>()</span><span class=o>?.</span><span class=na>trim</span><span class=p>()</span>
<a href=#__codelineno-9-90 id=__codelineno-9-90 name=__codelineno-9-90></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-91 id=__codelineno-9-91 name=__codelineno-9-91></a><span class=w>                </span><span class=s>"yes"</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Finish</span>
<a href=#__codelineno-9-92 id=__codelineno-9-92 name=__codelineno-9-92></a><span class=w>                </span><span class=s>"no"</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>JumpTo</span><span class=p>(</span><span class=n>NameStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span><span class=w> </span><span class=c1>// Mulai ulang</span>
<a href=#__codelineno-9-93 id=__codelineno-9-93 name=__codelineno-9-93></a><span class=w>                </span><span class=k>else</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-9-94 id=__codelineno-9-94 name=__codelineno-9-94></a><span class=w>            </span><span class=p>}</span>
<a href=#__codelineno-9-95 id=__codelineno-9-95 name=__codelineno-9-95></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-96 id=__codelineno-9-96 name=__codelineno-9-96></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-9-97 id=__codelineno-9-97 name=__codelineno-9-97></a>
<a href=#__codelineno-9-98 id=__codelineno-9-98 name=__codelineno-9-98></a><span class=w>    </span><span class=kd>object</span><span class=w> </span><span class=nc>FinishStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-99 id=__codelineno-9-99 name=__codelineno-9-99></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-100 id=__codelineno-9-100 name=__codelineno-9-100></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=kt>String?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>NameStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-9-101 id=__codelineno-9-101 name=__codelineno-9-101></a><span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>age</span><span class=p>:</span><span class=w> </span><span class=kt>Int?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>AgeStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-9-102 id=__codelineno-9-102 name=__codelineno-9-102></a>
<a href=#__codelineno-9-103 id=__codelineno-9-103 name=__codelineno-9-103></a><span class=w>            </span><span class=c1>// Simpan ke database, kirim konfirmasi, dll.</span>
<a href=#__codelineno-9-104 id=__codelineno-9-104 name=__codelineno-9-104></a><span class=w>            </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span>
<a href=#__codelineno-9-105 id=__codelineno-9-105 name=__codelineno-9-105></a><span class=w>                </span><span class=s>"Registration complete! Welcome, </span><span class=si>$</span><span class=n>name</span><span class=s> (age </span><span class=si>$</span><span class=n>age</span><span class=s>)."</span><span class=w> </span>
<a href=#__codelineno-9-106 id=__codelineno-9-106 name=__codelineno-9-106></a><span class=w>            </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-9-107 id=__codelineno-9-107 name=__codelineno-9-107></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-108 id=__codelineno-9-108 name=__codelineno-9-108></a>
<a href=#__codelineno-9-109 id=__codelineno-9-109 name=__codelineno-9-109></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>Unit</span>
<a href=#__codelineno-9-110 id=__codelineno-9-110 name=__codelineno-9-110></a>
<a href=#__codelineno-9-111 id=__codelineno-9-111 name=__codelineno-9-111></a><span class=w>        </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-112 id=__codelineno-9-112 name=__codelineno-9-112></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Finish</span>
<a href=#__codelineno-9-113 id=__codelineno-9-113 name=__codelineno-9-113></a><span class=w>        </span><span class=p>}</span>
<a href=#__codelineno-9-114 id=__codelineno-9-114 name=__codelineno-9-114></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-9-115 id=__codelineno-9-115 name=__codelineno-9-115></a><span class=p>}</span>
</code></pre></div> <hr> <h3 id=fitur-lanjutan>Fitur Lanjutan<a title="Permanent link" class=headerlink href=#fitur-lanjutan>¶</a></h3> <h4 id=transisi-bersyarat>Transisi Bersyarat<a title="Permanent link" class=headerlink href=#transisi-bersyarat>¶</a></h4> <p>Gunakan <code>Transition.JumpTo</code> untuk alur bersyarat:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=n>Transition</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>choice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>update</span><span class=p>.</span><span class=na>text</span><span class=o>?.</span><span class=na>lowercase</span><span class=p>()</span>
<a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=p>(</span><span class=n>choice</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a><span class=w>        </span><span class=s>"premium"</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>JumpTo</span><span class=p>(</span><span class=n>PremiumStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
<a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a><span class=w>        </span><span class=s>"basic"</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>JumpTo</span><span class=p>(</span><span class=n>BasicStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span>
<a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>Transition</span><span class=p>.</span><span class=na>Retry</span>
<a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a><span class=p>}</span>
</code></pre></div> <h4 id=langkah-tanpa-status>Langkah Tanpa Status<a title="Permanent link" class=headerlink href=#langkah-tanpa-status>¶</a></h4> <p>Langkah tidak perlu menyimpan status. Cukup kembalikan <code>null</code> dari <code>store()</code> (atau biarkan seperti itu):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=kd>object</span><span class=w> </span><span class=nc>ConfirmationStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>store</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>):</span><span class=w> </span><span class=kt>Any?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=w>    </span><span class=c1>// ... sisa implementasi</span>
<a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a><span class=p>}</span>
</code></pre></div> <h4 id=state-manager-kustom>State Manager Kustom<a title="Permanent link" class=headerlink href=#state-manager-kustom>¶</a></h4> <p>Implementasikan <code>WizardStateManager&lt;T></code> untuk penyimpanan kustom (database, Redis, dll.):</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a><span class=kd>class</span><span class=w> </span><span class=nc>DatabaseStateManager</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStateManager</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>></span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-12-2 id=__codelineno-12-2 name=__codelineno-12-2></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>get</span><span class=p>(</span>
<a href=#__codelineno-12-3 id=__codelineno-12-3 name=__codelineno-12-3></a><span class=w>        </span><span class=n>key</span><span class=p>:</span><span class=w> </span><span class=n>KClass</span><span class=o>&lt;</span><span class=k>out</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=p>,</span>
<a href=#__codelineno-12-4 id=__codelineno-12-4 name=__codelineno-12-4></a><span class=w>        </span><span class=n>reference</span><span class=p>:</span><span class=w> </span><span class=n>UserChatReference</span>
<a href=#__codelineno-12-5 id=__codelineno-12-5 name=__codelineno-12-5></a><span class=w>    </span><span class=p>):</span><span class=w> </span><span class=kt>String?</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-12-6 id=__codelineno-12-6 name=__codelineno-12-6></a><span class=w>        </span><span class=c1>// Muat dari database</span>
<a href=#__codelineno-12-7 id=__codelineno-12-7 name=__codelineno-12-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>database</span><span class=p>.</span><span class=na>getWizardState</span><span class=p>(</span><span class=n>reference</span><span class=p>.</span><span class=na>userId</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>qualifiedName</span><span class=p>)</span>
<a href=#__codelineno-12-8 id=__codelineno-12-8 name=__codelineno-12-8></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-12-9 id=__codelineno-12-9 name=__codelineno-12-9></a>
<a href=#__codelineno-12-10 id=__codelineno-12-10 name=__codelineno-12-10></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>set</span><span class=p>(</span>
<a href=#__codelineno-12-11 id=__codelineno-12-11 name=__codelineno-12-11></a><span class=w>        </span><span class=n>key</span><span class=p>:</span><span class=w> </span><span class=n>KClass</span><span class=o>&lt;</span><span class=k>out</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=p>,</span>
<a href=#__codelineno-12-12 id=__codelineno-12-12 name=__codelineno-12-12></a><span class=w>        </span><span class=n>reference</span><span class=p>:</span><span class=w> </span><span class=n>UserChatReference</span><span class=p>,</span>
<a href=#__codelineno-12-13 id=__codelineno-12-13 name=__codelineno-12-13></a><span class=w>        </span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=kt>String</span>
<a href=#__codelineno-12-14 id=__codelineno-12-14 name=__codelineno-12-14></a><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-12-15 id=__codelineno-12-15 name=__codelineno-12-15></a><span class=w>        </span><span class=c1>// Simpan ke database</span>
<a href=#__codelineno-12-16 id=__codelineno-12-16 name=__codelineno-12-16></a><span class=w>        </span><span class=n>database</span><span class=p>.</span><span class=na>saveWizardState</span><span class=p>(</span><span class=n>reference</span><span class=p>.</span><span class=na>userId</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>qualifiedName</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span>
<a href=#__codelineno-12-17 id=__codelineno-12-17 name=__codelineno-12-17></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-12-18 id=__codelineno-12-18 name=__codelineno-12-18></a>
<a href=#__codelineno-12-19 id=__codelineno-12-19 name=__codelineno-12-19></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>del</span><span class=p>(</span>
<a href=#__codelineno-12-20 id=__codelineno-12-20 name=__codelineno-12-20></a><span class=w>        </span><span class=n>key</span><span class=p>:</span><span class=w> </span><span class=n>KClass</span><span class=o>&lt;</span><span class=k>out</span><span class=w> </span><span class=n>WizardStep</span><span class=o>></span><span class=p>,</span>
<a href=#__codelineno-12-21 id=__codelineno-12-21 name=__codelineno-12-21></a><span class=w>        </span><span class=n>reference</span><span class=p>:</span><span class=w> </span><span class=n>UserChatReference</span>
<a href=#__codelineno-12-22 id=__codelineno-12-22 name=__codelineno-12-22></a><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-12-23 id=__codelineno-12-23 name=__codelineno-12-23></a><span class=w>        </span><span class=c1>// Hapus dari database</span>
<a href=#__codelineno-12-24 id=__codelineno-12-24 name=__codelineno-12-24></a><span class=w>        </span><span class=n>database</span><span class=p>.</span><span class=na>deleteWizardState</span><span class=p>(</span><span class=n>reference</span><span class=p>.</span><span class=na>userId</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>qualifiedName</span><span class=p>)</span>
<a href=#__codelineno-12-25 id=__codelineno-12-25 name=__codelineno-12-25></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-12-26 id=__codelineno-12-26 name=__codelineno-12-26></a><span class=p>}</span>
</code></pre></div> <hr> <h3 id=cara-kerja-internal>Cara Kerja Internal<a title="Permanent link" class=headerlink href=#cara-kerja-internal>¶</a></h3> <h4 id=generasi-kode>Generasi Kode<a title="Permanent link" class=headerlink href=#generasi-kode>¶</a></h4> <p>KSP menghasilkan:</p> <ol><li><strong>WizardActivity</strong>: Implementasi konkret yang memperluas <code>WizardActivity</code> dengan langkah-langkah yang di-hardcode<li><strong>Start Activity</strong>: Menangani trigger perintah dan memulai wizard<li><strong>Input Activity</strong>: Menangani input pengguna selama alur wizard<li><strong>State Accessors</strong>: Fungsi ekstensi type-safe untuk akses status</ol> <h4 id=alur>Alur<a title="Permanent link" class=headerlink href=#alur>¶</a></h4> <ol><li>Pengguna mengirim <code>/register</code> → Start Activity dipanggil<li>Start Activity membuat <code>WizardContext</code> dan memanggil <code>wizardActivity.start(ctx)</code><li><code>start()</code> memasuki langkah awal dan mengatur <code>inputListener</code> untuk melacak langkah saat ini<li>Pengguna mengirim pesan → Input Activity dipanggil<li>Input Activity memanggil <code>wizardActivity.handleInput(ctx)</code><li><code>handleInput()</code> memvalidasi input, menyimpan status, dan beralih ke langkah berikutnya<li>Proses berulang hingga <code>Transition.Finish</code> dikembalikan</ol> <h4 id=persistensi-status>Persistensi Status<a title="Permanent link" class=headerlink href=#persistensi-status>¶</a></h4> <ul><li>Status disimpan setelah validasi berhasil (sebelum transisi)<li>Nilai kembalian <code>store()</code> dari setiap langkah disimpan menggunakan <code>WizardStateManager</code> yang cocok<li>Status di-scope per pengguna dan chat (<code>UserChatReference</code>)</ul> <hr> <h3 id=praktik-terbaik>Praktik Terbaik<a title="Permanent link" class=headerlink href=#praktik-terbaik>¶</a></h3> <h4 id=1-selalu-berikan-prompt-yang-jelas>1. Selalu Berikan Prompt yang Jelas<a title="Permanent link" class=headerlink href=#1-selalu-berikan-prompt-yang-jelas>¶</a></h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-13-2 id=__codelineno-13-2 name=__codelineno-13-2></a><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span>
<a href=#__codelineno-13-3 id=__codelineno-13-3 name=__codelineno-13-3></a><span class=w>        </span><span class=s>"Please enter your email address:\n"</span><span class=w> </span><span class=o>+</span>
<a href=#__codelineno-13-4 id=__codelineno-13-4 name=__codelineno-13-4></a><span class=w>        </span><span class=s>"(Format: user@example.com)"</span><span class=w> </span>
<a href=#__codelineno-13-5 id=__codelineno-13-5 name=__codelineno-13-5></a><span class=w>    </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-13-6 id=__codelineno-13-6 name=__codelineno-13-6></a><span class=p>}</span>
</code></pre></div> <h4 id=2-tangani-kesalahan-validasi-dengan-baik>2. Tangani Kesalahan Validasi dengan Baik<a title="Permanent link" class=headerlink href=#2-tangani-kesalahan-validasi-dengan-baik>¶</a></h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onRetry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a><span class=w>    </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span>
<a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a><span class=w>        </span><span class=s>"Invalid email format. Please try again.\n"</span><span class=w> </span><span class=o>+</span>
<a href=#__codelineno-14-4 id=__codelineno-14-4 name=__codelineno-14-4></a><span class=w>        </span><span class=s>"Example: user@example.com"</span><span class=w> </span>
<a href=#__codelineno-14-5 id=__codelineno-14-5 name=__codelineno-14-5></a><span class=w>    </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-14-6 id=__codelineno-14-6 name=__codelineno-14-6></a><span class=p>}</span>
</code></pre></div> <h4 id=3-gunakan-akses-status-type-safe>3. Gunakan Akses Status Type-Safe<a title="Permanent link" class=headerlink href=#3-gunakan-akses-status-type-safe>¶</a></h4> <p>Lebih suka metode type-safe yang dihasilkan:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a><span class=c1>// ✅ Bagus - type-safe</span>
<a href=#__codelineno-15-2 id=__codelineno-15-2 name=__codelineno-15-2></a><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=p>:</span><span class=w> </span><span class=kt>String?</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=o>&lt;</span><span class=n>NameStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-15-3 id=__codelineno-15-3 name=__codelineno-15-3></a>
<a href=#__codelineno-15-4 id=__codelineno-15-4 name=__codelineno-15-4></a><span class=c1>// ❌ Hindari - kehilangan type safety</span>
<a href=#__codelineno-15-5 id=__codelineno-15-5 name=__codelineno-15-5></a><span class=kd>val</span><span class=w> </span><span class=nv>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>getState</span><span class=p>(</span><span class=n>NameStep</span><span class=o>::</span><span class=n>class</span><span class=p>)</span><span class=w> </span><span class=k>as?</span><span class=w> </span><span class=kt>String</span>
</code></pre></div> <h4 id=4-pertahankan-langkah-yang-fokus>4. Pertahankan Langkah yang Fokus<a title="Permanent link" class=headerlink href=#4-pertahankan-langkah-yang-fokus>¶</a></h4> <p>Setiap langkah harus memiliki tanggung jawab tunggal:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a><span class=c1>// ✅ Bagus - langkah fokus</span>
<a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a><span class=kd>object</span><span class=w> </span><span class=nc>EmailStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a><span class=w>    </span><span class=c1>// Hanya menangani pengumpulan email</span>
<a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a><span class=p>}</span>
<a href=#__codelineno-16-5 id=__codelineno-16-5 name=__codelineno-16-5></a>
<a href=#__codelineno-16-6 id=__codelineno-16-6 name=__codelineno-16-6></a><span class=c1>// ❌ Hindari - terlalu banyak logika</span>
<a href=#__codelineno-16-7 id=__codelineno-16-7 name=__codelineno-16-7></a><span class=kd>object</span><span class=w> </span><span class=nc>PersonalInfoStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-16-8 id=__codelineno-16-8 name=__codelineno-16-8></a><span class=w>    </span><span class=c1>// Menangani nama, email, telepon, alamat...</span>
<a href=#__codelineno-16-9 id=__codelineno-16-9 name=__codelineno-16-9></a><span class=p>}</span>
</code></pre></div> <h4 id=5-gunakan-nama-langkah-yang-bermakna>5. Gunakan Nama Langkah yang Bermakna<a title="Permanent link" class=headerlink href=#5-gunakan-nama-langkah-yang-bermakna>¶</a></h4> <div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a><span class=c1>// ✅ Bagus</span>
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a><span class=kd>object</span><span class=w> </span><span class=nc>EmailVerificationStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span>
<a href=#__codelineno-17-3 id=__codelineno-17-3 name=__codelineno-17-3></a>
<a href=#__codelineno-17-4 id=__codelineno-17-4 name=__codelineno-17-4></a><span class=c1>// ❌ Hindari</span>
<a href=#__codelineno-17-5 id=__codelineno-17-5 name=__codelineno-17-5></a><span class=kd>object</span><span class=w> </span><span class=nc>Step2</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span>
</code></pre></div> <h4 id=6-bersihkan-status-jika-diperlukan>6. Bersihkan Status Jika Diperlukan<a title="Permanent link" class=headerlink href=#6-bersihkan-status-jika-diperlukan>¶</a></h4> <p>Jika Anda perlu menghapus status secara manual:</p> <div class=highlight><pre><span></span><code><a href=#__codelineno-18-1 id=__codelineno-18-1 name=__codelineno-18-1></a><span class=kd>object</span><span class=w> </span><span class=nc>CancelStep</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>WizardStep</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-18-2 id=__codelineno-18-2 name=__codelineno-18-2></a><span class=w>    </span><span class=kd>override</span><span class=w> </span><span class=kd>suspend</span><span class=w> </span><span class=kd>fun</span><span class=w> </span><span class=nf>onEntry</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span><span class=w> </span><span class=n>WizardContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-18-3 id=__codelineno-18-3 name=__codelineno-18-3></a><span class=w>        </span><span class=c1>// Hapus semua status wizard</span>
<a href=#__codelineno-18-4 id=__codelineno-18-4 name=__codelineno-18-4></a><span class=w>        </span><span class=n>ctx</span><span class=p>.</span><span class=na>delState</span><span class=o>&lt;</span><span class=n>NameStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-18-5 id=__codelineno-18-5 name=__codelineno-18-5></a><span class=w>        </span><span class=n>ctx</span><span class=p>.</span><span class=na>delState</span><span class=o>&lt;</span><span class=n>AgeStep</span><span class=o>></span><span class=p>()</span>
<a href=#__codelineno-18-6 id=__codelineno-18-6 name=__codelineno-18-6></a>
<a href=#__codelineno-18-7 id=__codelineno-18-7 name=__codelineno-18-7></a><span class=w>        </span><span class=n>message</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>"Registration cancelled."</span><span class=w> </span><span class=p>}.</span><span class=na>send</span><span class=p>(</span><span class=n>ctx</span><span class=p>.</span><span class=na>user</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>.</span><span class=na>bot</span><span class=p>)</span>
<a href=#__codelineno-18-8 id=__codelineno-18-8 name=__codelineno-18-8></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-18-9 id=__codelineno-18-9 name=__codelineno-18-9></a><span class=p>}</span>
</code></pre></div> <hr> <h3 id=ringkasan>Ringkasan<a title="Permanent link" class=headerlink href=#ringkasan>¶</a></h3> <p>Sistem Wizard menyediakan: - ✅ <strong>Type-safe</strong> manajemen status dengan pemeriksaan waktu kompilasi - ✅ <strong>Declarative</strong> definisi langkah sebagai kelas bersarang - ✅ <strong>Flexible</strong> transisi dengan logika bersyarat - ✅ <strong>Automatic</strong> generasi kode via KSP - ✅ <strong>Integrated</strong> dengan sistem Activity yang ada - ✅ <strong>Pluggable</strong> backend penyimpanan status</p> <p>Mulailah membangun wizard dengan menganotasi kelas dengan <code>@WizardHandler</code> dan mendefinisikan langkah-langkah Anda sebagai objek <code>WizardStep</code> bersarang!</p> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> <button class="md-top md-icon" data-md-component=top hidden type=button><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Kembali ke atas</button> <footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a aria-label="Sebelumnya: F.A.Q" class="md-footer__link md-footer__link--prev" href=../F.A.Q/> <div class="md-footer__button md-icon"><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></div> <div class=md-footer__title><span class=md-footer__direction> Sebelumnya </span><div class=md-ellipsis>F.A.Q</div></div> </a><a aria-label="Selanjutnya: Functional Dsl" class="md-footer__link md-footer__link--next" href=../Functional-DSL/> <div class=md-footer__title><span class=md-footer__direction> Selanjutnya </span><div class=md-ellipsis>Functional Dsl</div></div> <div class="md-footer__button md-icon"><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg></div> </a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright>Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a></div></div></div></footer> <div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.footer", "navigation.tabs", "navigation.top", "navigation.tracking", "search.share", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Tersalin ke clipboard", "clipboard.copy": "Salin ke clipboard", "search.result.more.one": "1 lagi di halaman ini", "search.result.more.other": "# lagi di halaman ini", "search.result.none": "Tidak ada dokumen yang sesuai", "search.result.one": "1 dokumen ditemukan", "search.result.other": "# dokumen ditemukan", "search.result.placeholder": "Ketik untuk mulai pencarian", "search.result.term.missing": "Tidak ada", "select.version": "Pilih versi"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> 